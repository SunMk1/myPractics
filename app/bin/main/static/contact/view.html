<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>연락처</title>
</head>
<body>
    <h1>연락처 상세정보</h1>
    <form>
        이름*: <input id="x-name" type="text"><br>
        메일 : <input id="x-mail" type="text" readonly><br>
        전화*: <input id="x-tel" type="text"><br>
        회사 : <input id="x-company" type="text"><br>
        별표(*)는 필수 입력 사항입니다.<br>
        <button id="x-update-btn" type="button">변경</button>
        <button id="x-delete-btn" type="button">삭제</button>
        <button id="x-cancel-btn" type="button">취소</button>
    </form>


    <script>
        // 쿼리스트링으로 이메일 추출...
        var arr = location.href.split("?");
        console.log(arr);

        if (arr.length == 1) {
            alert("요청 형식이 옳바르지 않습니다.")
            throw "URL 형식 오류!";
        }

        var qs = arr[1];
        console.log(qs);

        var mail;
            if (qs.startsWith("mail=")) {
            mail = qs.split("=")[1];
            }

        if (mail == null) {
            alert("이메일 값이 없습니다.");
            throw "파라미터 오류!";
        }
        console.log(mail);


        var xName = document.querySelector("#x-name")
        var xMail = document.querySelector("#x-mail")
        var xTel = document.querySelector("#x-tel")
        var xCompany = document.querySelector("#x-company")

        fetch(`/contact/get?mail=${mail}`)
            .then(function(response){
                return response.text()
            })
            .then(function(textData){
                var nowData = textData.split(",")
                xName.value = nowData[0]
                xMail.value = nowData[1]
                xTel.value = nowData[2]
                xCompany.value = nowData[3]
                console.log(nowData)
            })
            
        document.querySelector("#x-update-btn").addEventListener("click", function(e){
            if (xName.value == "" || xTel.value == ""){
                alert("필수 입력 사항을 확인해주세요")
                return
            }
            fetch(`/contact/update?name=${xName.value}&mail=${xMail.value}&tel=${xTel.value}&company=${xCompany.value}`)
            .then(function(response){
                return response.text()
            })
            .then(function(textData){
                location.href = "index.html"
            })
        })
        document.querySelector("#x-delete-btn").addEventListener("click", function(e){
            fetch(`/contact/delete?mail=${mail}`)
                location.href = "index.html"
            })

        document.querySelector("#x-cancel-btn").addEventListener("click", function(e){
            location.href = "index.html"
        })

    </script>
</body>
</html>